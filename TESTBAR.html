<!DOCTYPE html>
<html>

<head>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        canvas {
            max-width: 50%;
            max-height: 90%;
        }
    </style>
</head>

<body>
    <h1>收入分布图</h1>
    <div style="width: 100%;">
        <canvas id="incomeChart"></canvas>
    </div>

    <script>
        var incomeChart;

        function fetchDataAndInitializeChart() {
            // 使用 AJAX 请求获取数据
            fetch('/get_income_data')
                .then(response => response.json())
                .then(data => {
                    initializeChart(data);
                })
                .catch(error => console.error('Error fetching data:', error));
        }

        function initializeChart(incomes) {
            var incomeCtx = document.getElementById("incomeChart").getContext("2d");

            incomeChart = new Chart(incomeCtx, {
                type: "bar",
                data: {
                    labels: incomes.map(income => income.toString()), // 将收入值转换为字符串
                    datasets: [{
                        label: "人数",
                        data: generateRandomCounts(incomes.length), // 根据数据长度生成随机人数
                        backgroundColor: "rgba(75, 192, 192, 0.2)",
                        borderColor: "rgba(75, 192, 192, 1)",
                        borderWidth: 1
                    }]
                },
                options: {
                    scales: {
                        x: {
                            beginAtZero: true
                        },
                        y: {
                            beginAtZero: true
                        }
                    }
                }
            });
        }

        function generateRandomCounts(count) {
            var counts = [];
            for (var i = 0; i < count; i++) {
                counts.push(Math.floor(Math.random() * 100));
            }
            return counts;
        }

        // 获取数据并初始化图表
        fetchDataAndInitializeChart();
    </script>
</body>

</html>